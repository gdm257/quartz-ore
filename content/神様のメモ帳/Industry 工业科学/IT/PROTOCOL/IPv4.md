---
aliases:
- Internet Protocol Version 4
tags:
- Label/Industry-工业科学/IT/TCP_IP/Protocol/3-互联网层-网络层
---

[全中国一共有多少IP地址？-51CTO.COM](https://www.51cto.com/article/693790.html)

IPv4 == 32 bits == 4 bytes == 4 个十进制の 0-255
IP 地址形成经历了 3 个阶段，分类地址（1981）、划分子网（1985）、构建超网（1993）。
注意，这几个阶段，IP 地址总数从未改变，都是 2^32 减去一些保留地址、私有地址，变化的是 IP 的分配方式。
理论上，【分类地址】也可以做到不浪费，只要你每个网段持有者都能充分利用所有主机号，但现实是，网段持有者会让大量主机号空闲，为了更合理地分配，于是朝着下一个阶段前进。
你问为什么会出现「网络号」「主机号」？为了批量分配啊，IP 一个个分多麻烦。
表示方法位点分十进制，8 bits 一组，每组写成一个十进制数（0-255）

【分类地址】

- IPv4
    - CIDR
        - Class A `0.0.0.0/1`
            - Reserved IP: `0.0.0.0/8`, `127.0.0.0/8`
                - `0.0.0.0` means all addresses
                - `127.0.0.0/8` are only used for loopback
            - Private IP: `10.0.0.0/8`, `100.64.0.0/10`(`100.64.0.0/8`-`100.127.0.0/8`)
        - Class B `128.0.0.0/2`
            - Private IP: `127.16.0.0/12`(`172.16.0.0/16`-`172.31.0.0/16`)
        - Class C `192.0.0.0/2`
            - Private IP: `127.16.0.0/12`(`172.16.0.0/16`-`172.31.0.0/16`)
        - Class D `224.0.0.0/4` Multicast IP
        - Class E `240.0.0.0/4` Reserved IP
    - Subnet & Host
        - IP is divided into *network portion* and *host portion*
        - 网络号、主机号
        - host portion are all `0` means this *subnet*
        - host portion are all `1` means all hosts in this subnet i.e. *broadcast address*

【划分子网】

0. IP 地址 = 网络号 + 子网号 + 主机号
1. 子网掩码长度同 IP 地址，网络号和子网号对应位全部位 1，主机号对应位全部为 0
2. IP 地址、子网掩码相与得到 网络地址
3. VLSM：变长子网掩码。简单地说，就是任意长度的子网掩码。在已经使用子网掩码的基础上，再借用主机号的前几位来加长子网号，这样就能避免主机号的浪费。例如，持有 x.x.x.x/24，如果我的某个子网只需要14 个主机号，那么 32 位中只要保留 4 位给主机号就好，即路由器的公网 IP 使用 .../28。

【构造超网】

0. IP 地址 = 网络前缀 + 主机号
1. /x 表示前 x 位位网络前缀，达到路由聚合、无分类编址
2. 地址块大小 = 2^(32 - n) = 该网段の最大主机号数量


【疑惑】

1. 「网络地址」是什么，和「网络号」有什么区别？
经过查证「图解TCP/IP」，IP 地址由「网络标识（网络地址）」「主机标识（主机地址）」组成。所以「网络地址」就是「网络号」。
2. 3 种阶段的方法表示 3 个不同的网络地址，是否会产生相同の点分十进制？
...还不知道，但我觉得单纯的 128 位 IP 是无法支持无分类 IP 的，必须要配合子网掩码或 CIRD
3. 「网段」= 唯一网络部分 + 任意主机号 吗？
经过查证，是的。还可以表述为「网络前缀.0」，或「网络标识」「网络前缀」「网络号」

既然公网 IP 根本不区分网络号和主机号，干嘛还可变长呢？
公网 IP 是给机器用的，每一个 32 bits 的 IP 有且仅有一个公网 IP，那就是它本身。
但我说过了，网段是方便人使用的。首先区分网络号分配起来方便，可变长则是避免分配会浪费。其次，网段这个概念也可在计算机中批量匹配 IP，如同正则

公网 IP 其实无所谓网段，反正都能直连。「网段（网络号）」是让访问私有 IP 成为可能。

一般来说，我们的网卡没有公网 IP，所以设置 IPv4 时还要附上子网掩码。什么是子网掩码？子网掩码，就是，把 32 bits 的 IP 分成网络号、主机号这两部分，网络号相同，那么可以相互访问。



【127.0.0.1 与 0.0.0.0】

你可以吧 127.0.0.1 所绑定的 lo 视为“网卡”，视作和外网 /内网 ip 绑定的网卡比如 eth0 等效。
lo 网卡是为了本系统进程相互访问自己而“发明”的，外部网络访问不到这个“网卡”，lo 是专门为自己系统进程服务的。
eth0 这个才是绑定了能外部访问的外网 /内网 ip 的网卡。

你有个服务绑定在 8080 端口，**如果只让自己系统的进程访问，就绑定 127.0.0.1 这个 ip** （对，lo 这个“网卡”专门干这个的）
如果你要让外部也能访问，你就绑定 eth0 网卡上面的 ip，比如 192.168.1.10 。
如果你要都绑定， 就绑定 0.0.0.0 这个“ip”（代表了所有 ipv4 地址都绑定服务）

至于外部、内部访问服务会发生什么，你可以先简单了解下 tcp/ip，然后再从 iptables 上找到答案。

所谓的回环地址，通俗的讲，就是我们在主机上发送给127开头的IP地址的数据包会被发送的主机自己接收，根本传不出去，外部设备也无法通过回环地址访问到本机。

这句「根本发不出去」，我理解为无法发送到网络中的另一个设备，对吗？

小说明：正常的数据包会从IP层进入链路层，然后发送到网络上；而给回环地址发送数据包，数据包会直接被发送主机的IP层获取，后面就没有链路层他们啥事了。

0.0.0.0并不是一个真实的的IP地址，它表示本机中所有的IPV4地址。**监听 0.0.0.0 的端口，就是监听本机中所有 IP 的端口**，并且它不能作为目标地址

本机IP通常仅指在同一个局域网内，能同时被外部设备访问和本机访问的那些IP地址（可能不止一个）。像127.0.0.1这种一般是不被当作本机IP的。本机IP是与具体的网络接口绑定的，比如以太网卡、无线网卡或者PPP/PPPoE拨号网络的虚拟网卡，想要正常工作都要绑定一个地址，否则其他设备就不知道如何访问它。

反过来也一样，pc1中sever监听192.168.10.128，则pc1中的client可以连上192.168.10.128，127.0.0.1连不上；而pc2中client能连上192.168.10.128。

可以理解为，127 是一个超级独立的网卡，它只接受目标 ip 为 127、客户端 ip 为 127 的数据包。这样看来，127 就是一个交换机，客户端进程和服务器进程分别是单独的设备，连着这个交换机。这些进程从哪里来？只要一个进程发送数据的目标 ip 是 127，就自动成为客户端进程。哪些进程可以发送？本机进程，即 VPS 上运行的进程。所以外网无法访问，因为外网请求无法让其他本机进程给 127 发请求（数据），当然，你那么配置了就另当别论了（比如 SSH 隧道）。




【无关数据帧过滤 & IP 独立性】

理论上，我可以虚拟一张任意 IP 的网卡，例如 1.1.1.1，但是没人会把 1.1.1.1 的数据帧发给你，因为公网不认你。