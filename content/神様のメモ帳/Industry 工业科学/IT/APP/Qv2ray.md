---
tags:
    - Label/Industry-å·¥ä¸šç§‘å­¦/IT/APP/Command/CLI
    - flag/APP/Network
---

## Qv2ray
### è·¯ç”±

åœ¨è¯´è·¯ç”±ä¹‹å‰ï¼Œåšä¸€äº›æ€»ç»“ã€‚è¦è§£å†³ã€Œèµ°ä»£ç†è¿˜æ˜¯ç›´è¿ã€è¿™ä¸ªé—®é¢˜ï¼Œå”¯ä¸€çš„æ–¹æ³•å°±æ˜¯å»ºç«‹è§„åˆ™ï¼Œå“ªç§ç½‘ç«™èµ°ä»£ç†ï¼Œå“ªç§ä¸èµ°ï¼Œå“ªä¸ª IP èµ°ä»£ç†å“ªä¸ªä¸èµ°ï¼Œéƒ½åœ¨è¿™å¼ è¡¨é‡Œå†™çš„æ˜æ˜ç™½ç™½ã€‚

å¦‚æœæ˜¯ v2rayï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ 2 é‡ä¿éšœï¼š

1. qv2ray/v2rayn/clash å¯ä»¥è‡ªå®šä¹‰ä¸€äº›è·¯ç”±è§„åˆ™ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è§„åˆ™çš„æ ¼å¼å¯èƒ½ä¸ä¸€æ ·
2. v2ray-core è‡ªå¸¦æœ‰ geoip.dat geosite.dat

å¦‚æœä¸€ä¸ªè¯·æ±‚èƒ½åœ¨è‡ªå®šä¹‰çš„è·¯ç”±è§„åˆ™é‡ŒåŒ¹é…ä¸Šï¼Œé‚£å°±æŒ‰ç…§è‡ªå®šä¹‰çš„è·¯ç”±è§„åˆ™å¤„ç†ã€‚å¦‚æœå¹¶æ²¡æœ‰è¿™æ ·ä¸€æ¡è§„åˆ™ï¼Œé‚£å°±ç”¨ v2ray-core è‡ªå¸¦çš„ geoip.dat geosite.dat æ¥åŒ¹é…ã€‚å¦‚æœè¿˜æ˜¯åŒ¹é…ä¸äº†ï¼Œé‚£å°±æ²¡åŠæ³•äº†ï¼Œé»˜è®¤æ˜¯ä¸€å¾‹ç›´è¿å¤„ç†ã€‚ss ssr trojan ä¹Ÿå·®ä¸å¤šæ˜¯è¿™æ ·ã€‚



åœ¨é¦–é€‰é¡¹-è¿æ¥è®¾ç½®é‡Œé¢ç‚¹å¼€â€œç»•è¿‡ä¸­å›½å¤§é™†â€é€‰é¡¹å³å¯å¼€å¯è·¯ç”±æ¨¡å¼ï¼ˆpacæ¨¡å¼ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹è®¿é—®å›½å†…ç½‘ç«™æ—¶å€™éƒ½æ˜¯æ˜¾ç¤ºoutBound_DIRECT ç›´è¿æ¨¡å¼ï¼Œå¤–ç½‘è®¿é—®çš„æ—¶å€™æ˜¯æ˜¾ç¤ºçš„ä½ é…ç½®çš„åè®®çš„åç§°ã€‚

    AsIsï¼šåªä½¿ç”¨åŸŸåè¿›è¡Œè·¯ç”±é€‰æ‹©ã€‚é»˜è®¤å€¼ã€‚
    IPIfNonMatchï¼šå½“åŸŸåæ²¡æœ‰åŒ¹é…ä»»ä½•è§„åˆ™æ—¶ï¼Œå°†åŸŸåè§£ææˆ IPï¼ˆA è®°å½•æˆ– AAAA è®°å½•ï¼‰å†æ¬¡è¿›è¡ŒåŒ¹é…ï¼š
        å½“ä¸€ä¸ªåŸŸåæœ‰å¤šä¸ª A è®°å½•æ—¶ï¼Œä¼šå°è¯•åŒ¹é…æ‰€æœ‰çš„ A è®°å½•ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªä¸æŸä¸ªè§„åˆ™åŒ¹é…ä¸ºæ­¢ï¼›
        è§£æåçš„ IP ä»…åœ¨è·¯ç”±é€‰æ‹©æ—¶èµ·ä½œç”¨ï¼Œè½¬å‘çš„æ•°æ®åŒ…ä¸­ä¾ç„¶ä½¿ç”¨åŸå§‹åŸŸåã€‚
    IPOnDemandï¼šå½“åŒ¹é…æ—¶ç¢°åˆ°ä»»ä½•åŸºäº IP çš„è§„åˆ™ï¼Œå°†åŸŸåç«‹å³è§£æä¸º IP è¿›è¡ŒåŒ¹é…ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œæ ¹æ®æŸå¼€å‘è€…çš„æš´è®ºå‘è¨€ï¼š

    AsIsï¼šå¿«é€Ÿè§£æï¼Œä¸ç²¾ç¡®åˆ†æµï¼›
    IPIfNonMatchï¼šè§£æç¨æ…¢ï¼Œåˆ†æµç²¾ç¡®ï¼›
    IPOnDemandï¼šæ²¡åµç”¨ã€‚

    æ³¨ï¼šIPOnDemand ç†åº”æ˜¯æœ€æ…¢ä½†æœ€ç²¾ç¡®çš„ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒIPIfNonMatch å·²ç»è¶³å¤Ÿï¼Œå› æ­¤ IPOnDemand çš„å®é™…æ•ˆæœå¹¶ä¸æ˜æ˜¾ã€‚

ä½ å¯ä»¥æ ¹æ®ä½ çš„å®é™…éœ€æ±‚ï¼Œé€‰æ‹©ç›¸åº”çš„åŸŸåç­–ç•¥ã€‚é€šå¸¸æ¥è¯´ï¼ŒIPIfNonMatch æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹çš„ç†æƒ³é€‰æ‹©

Qv2ray ä¸­çš„æŒ‰ç…§ åŸŸåé˜»æ–­ -> åŸŸåä»£ç† -> åŸŸåç›´è¿ -> IPé˜»æ–­ -> IPä»£ç† -> IPç›´è¿ çš„ä¼˜å…ˆçº§è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œåˆ™ç§æœ‰åœ°å€å’Œå¤§é™†å¢ƒå†…åœ°å€ç›´è¿ï¼Œå¦åˆ™èµ°ä»£ç†ã€‚

æœ€åè¿™å¥å¦‚æœåŒ¹é…å¤±è´¥æƒ…å†µï¼Œåº”è¯¥æ˜¯ç”¨ v2ray èµ„æºç›®å½•ä¸‹çš„ geoip.dat geosite.dat æ¥åˆ¤æ–­æ˜¯å¤§é™†åœ°å€çš„ã€‚å¦‚æœè¿è¿™ä¸¤ä¸ªæ–‡ä»¶ä¹Ÿæ— æ³•åˆ¤æ–­ï¼Œé‚£å°±ç›´è¿ã€‚

æˆ‘æ˜¯èµ„æ·±ç”¨æˆ·ï¼æˆ‘éœ€è¦æ›´ç²¾ç¡®çš„åˆ†æµè§„åˆ™ï¼ğŸ¤”

æ¨èä½¿ç”¨ V2Ray è§„åˆ™æ–‡ä»¶åŠ å¼ºç‰ˆ é¡¹ç›®ï¼Œä»“åº“åœ°å€ä¸º Loyalsoldier/v2ray-rules-dat
(opens new window)ã€‚ğŸ¤—

V2Ray è·¯ç”±è§„åˆ™æ–‡ä»¶åŠ å¼ºç‰ˆï¼Œå¯ä»£æ›¿ V2Ray å®˜æ–¹ geoip.dat å’Œ geosite.dat è§„åˆ™æ–‡ä»¶ï¼Œå…¼å®¹ Trojan-Goã€‚åˆ©ç”¨ GitHub Actions åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 6 ç‚¹è‡ªåŠ¨æ„å»ºï¼Œä¿è¯è§„åˆ™æœ€æ–°ã€‚

ä¸‹è½½åœ°å€ï¼š

    å¦‚æœæ— æ³•è®¿é—®åŸŸå raw.githubusercontent.comï¼Œå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªåœ°å€ï¼ˆcdn.jsdelivr.netï¼‰ï¼Œä½†æ˜¯å†…å®¹æ›´æ–°ä¼šæœ‰ 12 å°æ—¶çš„å»¶è¿Ÿã€‚

    Windows ç”¨æˆ·å¯é€šè¿‡ Scoop æ¥å®‰è£…ï¼š
    scoop bucket add sushi https://github.com/kidonng/sushi
    scoop install -g v2ray-rules-dat

    é Windows ç”¨æˆ·ï¼š

    ç‚¹å‡»ä¸Šé¢ä¸‹è½½åœ°å€ï¼Œä¸‹è½½ geoip.dat å’Œ geosite.dat
    æŠŠä¸‹è½½ä¸‹æ¥çš„ geoip.dat å’Œ geosite.dat æ–‡ä»¶æ”¾å…¥åˆ° V2Ray çš„è§„åˆ™æ–‡ä»¶ç›®å½•ï¼Œæ›¿æ¢æ‰åŸæ¥çš„ geoip.dat å’Œ geosite.dat
    ä¿®æ”¹ V2Ray é…ç½®æ–‡ä»¶ï¼Œé…ç½®å‚è€ƒä¸‹é¢ ğŸ‘‡ğŸ‘‡ğŸ‘‡



ã€IP å†™æ³•ã€‘

ç”¨æ­£åˆ™æ¥è§£é‡Šå„ä¸ªç±»å‹æ˜¯å¦‚ä½•åŒ¹é…çš„

geoip:<åŒå­—ç¬¦å›½å®¶ä»£ç >
geoip:private
x.x.x.x
x.x.x.x/x
ext:FileName:Tag

"ext:geoip.dat:cn" ç­‰ä»·äº "geoip:cn"
é‚£ä¹ˆ "ext:geosite.dat:cn" å°±åº”è¯¥ç­‰ä»·äº "geosite:cn"
æ‰€ä»¥ geoip: geosite: åè¾¹è·Ÿçš„å…¶å®æ˜¯è¿™ä¸¤ä¸ªæ–‡ä»¶æ‰€åŒ…å«çš„ Tagï¼Œä¸¥æ ¼æ¥è¯´ geoip: geosite: å¹¶ä¸è¯¥å•ç‹¬åˆ†ä¸ºä¸€ç±»ï¼Œå®ƒä»¬å…¶å®æ˜¯ ext:FileName:Tag çš„ç®€å†™ç½¢äº†

"geoip:private" åº”è¯¥æ˜¯ç‰¹æŒ‡æ‰€æœ‰çš„ç§æœ‰åœ°å€ï¼Œåº”è¯¥åœ¨ geoip.dat é‡Œæœ‰ private è¿™ä¸ª tagï¼Œæ‰€ä»¥ä¸€ä¸ªå­—éƒ½ä¸èƒ½æ”¹ã€‚

åœ¨ [routing] é…ç½®ä¸­ï¼Œç±»åˆ«è¶Šé å‰ï¼ˆä¸Šï¼‰ï¼Œä¼˜å…ˆçº§è¶Šé«˜


ã€åŸŸåå†™æ³•ã€‘

ç”¨æ­£åˆ™æ¥è§£é‡Šå„ä¸ªç±»å‹æ˜¯å¦‚ä½•åŒ¹é…çš„

```
geosite:<åŸŸåç±»åˆ«>
domain:String$
full:^String$
String
regexp:<regexp>
ext:FileNameinV2RayResourceFolderwithoutExpanedName:Tag
```

åŸŸåç±»åˆ«è¯¦è§  v2fly/domain-list-community é¡¹ç›®çš„ data ç›®å½•ï¼Œç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶åéƒ½æ˜¯åŸŸåç±»åˆ«ï¼Œå¦‚ 115ã€googleã€appleã€baiduã€bilibili ç­‰ï¼Œæœ‰ä¸Šåƒä¸ªå‘¢