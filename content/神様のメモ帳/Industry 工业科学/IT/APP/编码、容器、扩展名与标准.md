---
tags:
  - flag/APP/Video/_Article/Player
  - Label/Article/APP
---

## 编码、容器、扩展名与标准

#### 编码

编码可分为音频编码、视频编码。
音频编码可分为有损编码、无损编码。
视频编码通常不看有损还是无损，所有常用的视频编码都支持有损压缩，有的编码同时支持有损压缩和无损压缩，有的编码只支持无损压缩。视频编码通常着重于算法、功能。

AAC 是一种 MPEG-2 标准的有损音频编码
AAC 也被包含在 MPEG-4 第三部分中
H264 是一种 MPEG-4 标准的视频编码，是 MPEG-4 第十部分


#### 容器

容器是一种封装格式，用于打包视频编码数据和音频编码数据。不同封装格式的不同点主要在于支持的编码不同。有的只能封装音频编码（只支持音频），有的只能封装视频编码（只支持视频），有的能封装音频和视频。

为什么要对编码进行封装呢？我直接播放编码好的文件不行吗，比如直接播放 .h264 视频文件不行吗？

可以。不过编码仅仅是对数据进行了压缩，虽然能直接进行解码播放，但缺少很多功能，而且兼容性不好。你可以类比 TCP 与应用层协议，应用层协议（编码）数量那么多，单独为这些协议做接口是一件很麻烦的事，而且会很乱，所以统统打包为 TCP（容器），这样就方便多了。

其实也有不进行封装的情况，例如 FLAC 编码文件我们就不进行封装，而是直接播放。当然 FLAC 编码文件是可以进行封装的，通常封装进 mkv 或 mka 容器里，二者通常用作视频音轨，而 FLAC 则是单独播放音频，可以说是不同使用场景会决定是否对编码文件进行封装。

MP3 是一种 MPEG-2 标准的支持有损编码的封装容器
MP4 是一种 MPEG-4 标准的多媒体封装格式，是 MPEG-4 第十四部分


#### 扩展名

扩展名是对文件命名的习惯。仅仅只是习惯，播放器播放的是数据，无论你怎么命名，里面的数据都是不会变的，扩展名仅仅用作参考而已。好的扩展名习惯有助于提高效率，但不是必须的。xx 扩展名也被叫做 xx 格式。

如果非要对扩展名分类，可以划分为 编码格式 与 封装格式，比较好理解，而不是所谓的视频格式音频格式。

请注意，扩展名和容器没有必然关系，例如 .264 文件是视频编码文件，而不是容器文件；.mp4 .mp3 .mkv 这种才是容器文件。为了更清楚，下面就列出常见的扩展名：

.wav
.flac
.ape
.opus
.mp3
.aac
.mka
.ogg
.264
.265
.mkv
.mp4
.flv
.ts
.avi
.rmvb
.mov

AAC 有损音频编码其实有 2 种，MPEG-2 AAC 和 MPEG-4 AAC，我们平时说的 AAC 是指后者。MPEG-4 AAC 的主要扩展名有 .aac .mp4 .m4a。为了区别纯音频 MP4 文件和包含视频的 MP4 文件，Apple iTunes 对纯音频MP4文件采用了 .m4a 命名（再次证明扩展名无关于编码、容器）。M4A 的本质和音频 MP4 相同，故音频 MP4 文件亦可直接更改扩展名为 M4A。

请注意，.aac 是编码文件，是 AAC 数据流；而 .mp4 是容器，是封装格式，MP4 是可以封装 AAC 或 ALAC 数据流的，ALAC 是无损音频编码。所以 .m4a 可能是无损，也可能是有损。

类似的，MKV 是一种封装标准，.mkv 是视频封装且可带音频及字幕，.mka 是单独的音频封装。

注意，mp3 是编码，mp4 是容器。
可以观察到，音频编码文件通常不进行封装，要封装也是跟着视频一起封装。
视频编码文件不会直接使用，通常都会封装，而且是跟着音频一起封装。


#### 标准

最后说说标准，标准是对多媒体数据的一整套技术规范，编码、容器、扩展名这些只是标准的一部分。在不同语境中，它可以指编码、或容器、或扩展名、或三者统称、或一整套技术规范。



MPEG-1是MPEG组织制定的第一个视频和音频有损压缩标准
MPEG-2是MPEG工作组于1994年发布的视频和音频压缩国际标准
MPEG-4包含了MPEG-1及MPEG-2的绝大部分功能及其他格式的长处


#### PCM

[PCM格式详解_青衫、故人的博客-CSDN博客_pcm格式](https://blog.csdn.net/weixin_43455834/article/details/105784926)

[PCM WAVE格式详解及用C语言实现wave文件的读取 - Bill's Blog](https://ibillxia.github.io/blog/2013/07/20/details-of-wave-format-and-reading-wave-files-in-C-language/)


PCM 是单个流还是混流还是多个流的封装？

复数流封装。一个 PCM 可以封装多个声道的流，因此 PCM 并不是单纯的 audio bytes，它显然是个容器，就像 MPEG 那样。



#### DSD

PCM 以非线性的方式记录采样点的值，DSD 则是线性，仅此而已。实际上 FLAC 等压缩算法就是把 PCM 转换为线性的记录方式（类似 AVC），压缩等级控制关键帧的数量。

我的理解是，DSD 用于模数转换，是一种数字格式，它的工作方式类似于 War3/LOL/Osu 录像，即每次采样只记录「相对于上一个状态的变化」。打个比方，PCM 每一个采样点都是关键帧，而 DSD 只有第一个采样点是关键帧，其后全是变化帧。也就是说，DSD 是线性的（尚不清楚 DSD 能否像 AVC 那样有多个关键帧）。

DSD 的核心是极高采样率。或者说 DSD 是为高采样率而生的。PCM 通常需要 16/24 bits 来记录每个采样点的值，对于 44.1/48/96 kHZ 采样率，存储效率还算可以接受。但对于极高采样率，动不动就以 MHz 为单位，每个采样点都使用 16 bits 实属浪费空间（所以才有了 FLAC 压缩算法），每个采样点只存储相比上一个采样点的变化值，这样才能优化存储效率，DSD 就是这么干的。DSD 对每个采样点只存储 1 bit 的数据，可以理解为相比上一个采样点是高了还是低了一个单位（不变呢？）。

不是因为 DSD 才高采样率，而是高采样率才 DSD。


#### FLAC

- 无损音频编码。
- 压缩等级 0-8，0 不压缩，8 最大压缩，默认为 5。经过测试，Lv 8 相比 Lv 5 体积缩小才 5% 左右，不值得，因此一律使用默认的 Lv 5 即可。